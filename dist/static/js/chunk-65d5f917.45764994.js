(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-65d5f917"],{1148:function(e,t,n){"use strict";var a=n("a691"),r=n("1d80");e.exports="".repeat||function(e){var t=String(r(this)),n="",l=a(e);if(l<0||l==1/0)throw RangeError("Wrong number of repetitions");for(;l>0;(l>>>=1)&&(t+=t))1&l&&(n+=t);return n}},"3e51":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-pagination",{attrs:{layout:"total,prev,pager,next",total:e.total,"page-size":e.pageSize,"current-page":e._currentPage},on:{"update:currentPage":function(t){e._currentPage=t},"update:current-page":function(t){e._currentPage=t},"current-change":e.currentChange}})],1)},r=[],l=(n("a9e3"),{props:{total:{type:Number,default:0},pageSize:{type:Number,default:10},currentPage:{type:Number,default:1}},data:function(){return{}},computed:{_currentPage:{get:function(){return this.currentPage},set:function(){return 1}}},methods:{currentChange:function(e){this.$emit("currentChange",e)}}}),i=l,s=n("2877"),o=Object(s["a"])(i,a,r,!1,null,null,null);t["a"]=o.exports},"408a":function(e,t,n){var a=n("c6b6");e.exports=function(e){if("number"!=typeof e&&"Number"!=a(e))throw TypeError("Incorrect invocation");return+e}},7156:function(e,t,n){var a=n("861d"),r=n("d2bb");e.exports=function(e,t,n){var l,i;return r&&"function"==typeof(l=t.constructor)&&l!==n&&a(i=l.prototype)&&i!==n.prototype&&r(e,i),e}},"7db0":function(e,t,n){"use strict";var a=n("23e7"),r=n("b727").find,l=n("44d2"),i=n("ae40"),s="find",o=!0,c=i(s);s in[]&&Array(1)[s]((function(){o=!1})),a({target:"Array",proto:!0,forced:o||!c},{find:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),l(s)},8062:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"margin-top":"25px"}},[n("el-row",[n("el-form",{staticStyle:{"margin-left":"10px"},attrs:{inline:!0}},[n("el-form-item",{attrs:{label:"机台"}},[n("el-select",{attrs:{placeholder:"请选择"},on:{change:e.equipChange,"visible-change":e.equipVisibleChange},model:{value:e.equip,callback:function(t){e.equip=t},expression:"equip"}},e._l(e.equipOptions,(function(e){return n("el-option",{key:e.equip_no,attrs:{label:e.equip_no,value:e.equip_no}})})),1)],1),n("el-form-item",{staticStyle:{float:"right"}},[e.permissionObj.plan.productclassesplan.indexOf("view")>-1?n("el-button",{attrs:{type:"info"},on:{click:e.showFindDialog}},[e._v("查询")]):e._e(),e.permissionObj.plan.productclassesplan.indexOf("add")>-1?n("el-button",{attrs:{type:"info"},on:{click:e.showAddPlanDialog}},[e._v("新增")]):e._e(),e.permissionObj.plan.productclassesplan.indexOf("change")>-1?n("el-button",{attrs:{type:"info",disabled:e.disabled},on:{click:e.stopPlan}},[e._v("停止")]):e._e(),e.permissionObj.plan.productclassesplan.indexOf("delete")>-1?n("el-button",{attrs:{type:"info",disabled:e.disabled},on:{click:e.delPlan}},[e._v("删除")]):e._e(),e.permissionObj.plan.productclassesplan.indexOf("change")>-1?n("el-button",{attrs:{type:"info",disabled:e.disabled},on:{click:e.issuedPlan}},[e._v("下达")]):e._e()],1)],1)],1),n("el-row",[n("el-form",{staticStyle:{"margin-left":"10px"},attrs:{inline:!0}},[n("el-form-item",{staticStyle:{float:"right"}},[e.permissionObj.plan.productclassesplan.indexOf("view")>-1?n("el-button",{attrs:{type:"info"},on:{click:e.refreshPlan}},[e._v("刷新")]):e._e(),e.permissionObj.plan.productclassesplan.indexOf("change")>-1?n("el-button",{attrs:{type:"info",disabled:e.disabled},on:{click:e.upPlan}},[e._v("上调")]):e._e(),e.permissionObj.plan.productclassesplan.indexOf("change")>-1?n("el-button",{attrs:{type:"info",disabled:e.disabled},on:{click:e.downPlan}},[e._v("下调")]):e._e(),e.permissionObj.plan.productclassesplan.indexOf("change")>-1?n("el-button",{attrs:{type:"info",disabled:e.disabled},on:{click:e.showAlterTrainNumberDialog}},[e._v("修改车次")]):e._e(),e.permissionObj.plan.productclassesplan.indexOf("change")>-1?n("el-button",{staticStyle:{width:"120px"},attrs:{type:"info",disabled:e.disabled},on:{click:e.retransmissionpPlan}},[e._v("重传")]):e._e()],1)],1)],1),n("div",{staticStyle:{"border-radius":"2px",border:".5px solid #000",padding:"10px"}},[n("el-row",[n("el-form",{staticStyle:{"margin-left":"10px"},attrs:{inline:!0}},[n("el-form-item",{attrs:{label:"机台"}},[n("el-input",{attrs:{type:"text",disabled:""},model:{value:e.equip,callback:function(t){e.equip=t},expression:"equip"}})],1)],1)],1),n("el-row",[n("el-form",{staticStyle:{"margin-left":"10px"},attrs:{inline:!0}},[n("el-form-item",{attrs:{label:"开始"}},[n("el-input",{staticStyle:{float:"left"},attrs:{type:"text",disabled:""},model:{value:e.currentAlive.begin_time,callback:function(t){e.$set(e.currentAlive,"begin_time",t)},expression:"currentAlive.begin_time"}})],1),n("el-form-item",{attrs:{label:"配方"}},[n("span",{staticStyle:{float:"right","margin-left":"60px"}}),n("el-input",{staticStyle:{float:"right"},attrs:{type:"text",disabled:""},model:{value:e.currentAlive.product_no,callback:function(t){e.$set(e.currentAlive,"product_no",t)},expression:"currentAlive.product_no"}})],1),n("el-form-item",{attrs:{label:"设定车次"}},[n("el-input",{staticStyle:{float:"left"},attrs:{type:"text",disabled:""},model:{value:e.currentAlive.plan_trains,callback:function(t){e.$set(e.currentAlive,"plan_trains",t)},expression:"currentAlive.plan_trains"}})],1),n("el-form-item",{attrs:{label:"状态"}},[n("el-input",{staticStyle:{float:"left"},attrs:{type:"text",disabled:""},model:{value:e.currentAlive.status,callback:function(t){e.$set(e.currentAlive,"status",t)},expression:"currentAlive.status"}})],1)],1)],1),n("el-row",[n("el-form",{staticStyle:{"margin-left":"10px"},attrs:{inline:!0}},[n("el-form-item",{attrs:{label:"结束"}},[n("el-input",{attrs:{type:"text",disabled:""},model:{value:e.currentAlive.end_time,callback:function(t){e.$set(e.currentAlive,"end_time",t)},expression:"currentAlive.end_time"}})],1),n("el-form-item",{attrs:{label:"当前计划"}},[n("span",{staticStyle:{float:"right","margin-left":"30px"}}),n("el-input",{attrs:{type:"text",disabled:""},model:{value:e.currentAlive.plan_classes_uid,callback:function(t){e.$set(e.currentAlive,"plan_classes_uid",t)},expression:"currentAlive.plan_classes_uid"}})],1),n("el-form-item",{attrs:{label:"当前车次"}},[n("el-input",{attrs:{type:"text",disabled:""},model:{value:e.currentAlive.actual_trains,callback:function(t){e.$set(e.currentAlive,"actual_trains",t)},expression:"currentAlive.actual_trains"}})],1)],1)],1)],1),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","highlight-current-row":""},on:{"current-change":e.handleCurrentChange}},[n("el-table-column",{attrs:{type:"index",label:"No",width:"55"}}),n("el-table-column",{attrs:{prop:"plan_classes_uid",label:"计划编号",width:"180"}}),n("el-table-column",{attrs:{prop:"sn",label:"序号",width:"55"}}),n("el-table-column",{attrs:{prop:"stage_product_batch_no",label:"配方名称",width:"150"}}),n("el-table-column",{attrs:{prop:"begin_time",label:"开始时间",width:"160"}}),n("el-table-column",{attrs:{prop:"end_time",label:"结束时间",width:"160"}}),n("el-table-column",{attrs:{prop:"equip_name",label:"机台",width:"100"}}),n("el-table-column",{attrs:{prop:"classes",label:"班次",width:"80"}}),n("el-table-column",{attrs:{prop:"plan_trains",label:"设定",width:"80"}}),n("el-table-column",{attrs:{prop:"actual_trains",label:"完成",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row&&t.row.actual_trains?n("div",[e._v(e._s(t.row.actual_trains))]):n("div",[e._v(e._s(0))])]}}])}),n("el-table-column",{attrs:{prop:"created_username",label:"操作员",width:"120"}}),n("el-table-column",{attrs:{prop:"status",label:"状态"}})],1),n("page",{attrs:{total:e.total,"current-page":e.page},on:{currentChange:e.currentChange}}),n("el-dialog",{attrs:{title:"查询计划",visible:e.findDialogVisible,width:"30%"},on:{"update:visible":function(t){e.findDialogVisible=t}}},[n("el-form",{attrs:{inline:!0}},[n("el-row",[n("el-form-item",{attrs:{label:"开始时间: "}},[n("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期"},model:{value:e.beginTime,callback:function(t){e.beginTime=t},expression:"beginTime"}})],1)],1),n("el-row",[n("el-form-item",{attrs:{label:"结束时间: "}},[n("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期"},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}})],1)],1),n("el-row",[n("el-form-item",{attrs:{label:"班次: "}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{"visible-change":e.classesVisibleChange},model:{value:e.classes,callback:function(t){e.classes=t},expression:"classes"}},e._l(e.classesOptions,(function(e){return n("el-option",{key:e.global_name,attrs:{label:e.global_name,value:e.global_name}})})),1)],1)],1),n("el-row",[n("el-form-item",{attrs:{label:"配方: "}},[n("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},on:{"visible-change":e.recipeVisibleChange},model:{value:e.recipe,callback:function(t){e.recipe=t},expression:"recipe"}},e._l(e.recipeOptions,(function(e,t){return n("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.findDialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.findAlterTrainNumberSubmit}},[e._v("确 定")])],1)],1),n("alter-train-number-dialog",{ref:"alterTrainNumberDialog",on:{handleSuccessed:e.getPlanList}}),n("add-plan-dialog",{ref:"addPlanDialog",on:{handleSuccessed:e.getPlanList}})],1)},r=[],l=(n("96cf"),n("1da1")),i=n("5530"),s=n("b775"),o=n("99b1");function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{params:{all:1,category_name:"密炼设备"}},n={url:o["a"].EquipUrl,method:e};return Object.assign(n,t),Object(s["a"])(n)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={url:o["a"].PalletFeedBackUrl,method:e};return Object.assign(n,t),Object(s["a"])(n)}function p(e){return Object(s["a"])({url:o["a"].PalletFeedBackUrl+e+"/",method:"DELETE"})}function d(e){return Object(s["a"])({url:o["a"].IssuedPlanUrl,method:"post",data:e})}function h(e){return Object(s["a"])({url:o["a"].StopPlanUrl,method:"get",params:e})}function f(e){return Object(s["a"])({url:o["a"].IssuedPlanUrl,method:"put",data:e})}function m(e,t){return Object(s["a"])({url:o["a"].UpRegulationUrl+t+"/",method:"put",data:e})}function b(e,t){return Object(s["a"])({url:o["a"].DownRegulationUrl+t+"/",method:"put",data:e})}function _(e,t){return Object(s["a"])({url:o["a"].UpdateTrainsUrl+t+"/",method:"put",data:e})}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={url:o["a"].ProductbatchingUrl,method:e};return Object.assign(n,t),Object(s["a"])(n)}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={url:o["a"].GlobalCodesUrl,method:e};return Object.assign(n,t),Object(s["a"])(n)}function w(e){return Object(s["a"])({url:o["a"].RubberMaterialUrl,method:"get",params:e})}function x(e){return Object(s["a"])({url:o["a"].WorkSchedulesUrl,method:"get",params:e})}function y(e){return Object(s["a"])({url:o["a"].PlanScheduleUrl,method:"get",params:e})}function k(e){return Object(s["a"])({url:o["a"].PlanScheduleUrl+e+"/",method:"get"})}function S(e){return Object(s["a"])({url:o["a"].ProductDayPlanManyCreateUrl,method:"post",data:e})}function O(e){return Object(s["a"])({url:o["a"].PlanStatusListUrl,method:"get",params:e})}var A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"修改车次",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{attrs:{inline:!0}},[n("el-row",[n("el-form-item",{attrs:{label:"计划编号: "}},[n("el-input",{attrs:{type:"text",disabled:!0},model:{value:e.currentRow.plan_classes_uid,callback:function(t){e.$set(e.currentRow,"plan_classes_uid",t)},expression:"currentRow.plan_classes_uid"}})],1)],1),n("el-row",[n("el-form-item",{attrs:{label:"配方名称: "}},[n("el-input",{attrs:{type:"text",disabled:!0},model:{value:e.currentRow.stage_product_batch_no,callback:function(t){e.$set(e.currentRow,"stage_product_batch_no",t)},expression:"currentRow.stage_product_batch_no"}})],1)],1),n("el-row",[n("el-form-item",{attrs:{label:"原设定车次: "}},[n("el-input",{attrs:{type:"text",disabled:!0},model:{value:e.currentRow.plan_trains,callback:function(t){e.$set(e.currentRow,"plan_trains",t)},expression:"currentRow.plan_trains"}})],1)],1),n("el-row",[n("el-form-item",{attrs:{label:"完成车次: "}},[e.currentRow.actual_trains?n("el-input",{attrs:{type:"text",disabled:!0},model:{value:e.currentRow.actual_trains,callback:function(t){e.$set(e.currentRow,"actual_trains",t)},expression:"currentRow.actual_trains"}}):n("el-input",{attrs:{value:"0",type:"text",disabled:!0}})],1)],1),n("el-row",[n("el-form-item",{attrs:{label:"修改后车次: ",error:e.formError[0]}},[n("el-input-number",{attrs:{precision:0,min:0},model:{value:e.trains,callback:function(t){e.trains=e._n(t)},expression:"trains"}})],1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.alterTrainNumberSubmit}},[e._v("确 定")])],1)],1)},P=[],F={data:function(){return{currentRow:{},trains:null,dialogVisible:!1,formError:[]}},methods:{show:function(e){this.currentRow=e,this.trains=null,this.dialogVisible=!0},alterTrainNumberSubmit:function(){this.trains>=0?this.trains-this.currentRow.actual_trains>=2?this.putUpdateTrains():(this.formError=[],this.formError.push("*修改车次必须大于完成车次+2")):(this.formError=[],this.formError.push("*不能为空"))},putUpdateTrains:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{_({trains:e.trains},e.currentRow.id).then((function(t){e.$message("修改成功"),e.dialogVisible=!1,e.$emit("handleSuccessed")}))}catch(n){}case 1:case"end":return t.stop()}}),t)})))()}}},q=F,R=n("2877"),E=Object(R["a"])(q,A,P,!1,null,null,null),I=E.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{width:"90%",visible:e.addPlanVisible,title:"添加胶料日生产计划"},on:{"update:visible":function(t){e.addPlanVisible=t}}},[n("div",{staticStyle:{"margin-bottom":"15px"}},[n("el-select",{staticStyle:{"margin-right":"10px"},attrs:{filterable:"",placeholder:"请选择机台"},model:{value:e.equipIdForAdd,callback:function(t){e.equipIdForAdd=t},expression:"equipIdForAdd"}},e._l(e.equips,(function(e){return n("el-option",{key:e.id,attrs:{label:e.equip_no,value:e.id}})})),1),n("el-date-picker",{staticStyle:{"margin-right":"10px"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:e.getPlanSchedules},model:{value:e.day_time,callback:function(t){e.day_time=t},expression:"day_time"}}),n("el-select",{attrs:{filterable:"",placeholder:"倒班规则"},model:{value:e.planScheduleId,callback:function(t){e.planScheduleId=t},expression:"planScheduleId"}},e._l(e.planSchedules,(function(e){return n("el-option",{key:e.id,attrs:{label:e.work_schedule__schedule_name,value:e.id}})})),1),n("el-button",{staticStyle:{float:"right"},attrs:{disabled:!e.saveEnable},on:{click:e.batchSave}},[e._v("保存")]),n("el-button",{on:{click:e.addOnePlan}},[e._v("添加")])],1),n("p",{staticStyle:{"text-align":"right",color:"red"}},[e._v(" "+e._s(e.weightError)+" ")]),n("p",{staticStyle:{"text-align":"right",color:"red"}},[e._v(" "+e._s(e.timeError)+" ")]),n("el-table",{attrs:{data:e.plansForAdd,border:""}},[n("el-table-column",{attrs:{fixed:"",prop:"equip_.equip_no",label:"机台"}}),n("el-table-column",{attrs:{fixed:"",prop:"work_schedule_name",label:"倒班规则"}}),n("el-table-column",{attrs:{fixed:"",prop:"day_time",label:"日期",width:"110"}}),n("el-table-column",{attrs:{label:"胶料配方编码",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.sum?void 0:[n("el-select",{attrs:{filterable:""},on:{change:function(n){return e.productBatchingChanged(t.row)}},model:{value:t.row.product_batching,callback:function(n){e.$set(t.row,"product_batching",n)},expression:"scope.row.product_batching"}},e._l(t.row.productBatchings,(function(e){return n("el-option",{key:e.id,attrs:{label:e.stage_product_batch_no,value:e.id}})})),1)]}}],null,!0)}),n("el-table-column",{attrs:{prop:"batching_weight",label:"配料重量（吨）"}}),n("el-table-column",{attrs:{prop:"production_time_interval",label:"炼胶时间（秒）"}}),n("el-table-column",{attrs:{label:"当前库存（吨）"}}),n("el-table-column",{attrs:{label:"早班计划"}},[n("el-table-column",{attrs:{label:"顺序",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return!t.row.sum&&t.row.pdp_product_classes_plan[0].enable?[n("el-input-number",{attrs:{precision:0,min:0},model:{value:t.row.pdp_product_classes_plan[0].sn,callback:function(n){e.$set(t.row.pdp_product_classes_plan[0],"sn",e._n(n))},expression:"scope.row.pdp_product_classes_plan[0].sn"}})]:void 0}}],null,!0)}),n("el-table-column",{attrs:{label:"车次",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.pdp_product_classes_plan[0].enable?[n("el-input-number",{attrs:{precision:0,disabled:t.row.sum,min:0},on:{change:function(n){return e.planTrainsChanged(t.row,0)}},model:{value:t.row.pdp_product_classes_plan[0].plan_trains,callback:function(n){e.$set(t.row.pdp_product_classes_plan[0],"plan_trains",e._n(n))},expression:"scope.row.pdp_product_classes_plan[0].plan_trains"}})]:void 0}}],null,!0)}),n("el-table-column",{attrs:{prop:"pdp_product_classes_plan[0].weight",label:"重量"}}),n("el-table-column",{attrs:{prop:"pdp_product_classes_plan[0].time",label:"时间"}})],1),n("el-table-column",{attrs:{label:"中班计划"}},[n("el-table-column",{attrs:{label:"顺序",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return!t.row.sum&&t.row.pdp_product_classes_plan[1].enable?[n("el-input-number",{attrs:{min:0,precision:0},model:{value:t.row.pdp_product_classes_plan[1].sn,callback:function(n){e.$set(t.row.pdp_product_classes_plan[1],"sn",e._n(n))},expression:"scope.row.pdp_product_classes_plan[1].sn"}})]:void 0}}],null,!0)}),n("el-table-column",{attrs:{label:"车次",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.pdp_product_classes_plan[1].enable?[n("el-input-number",{attrs:{precision:0,disabled:t.row.sum,min:0},on:{change:function(n){return e.planTrainsChanged(t.row,1)}},model:{value:t.row.pdp_product_classes_plan[1].plan_trains,callback:function(n){e.$set(t.row.pdp_product_classes_plan[1],"plan_trains",e._n(n))},expression:"scope.row.pdp_product_classes_plan[1].plan_trains"}})]:void 0}}],null,!0)}),n("el-table-column",{attrs:{prop:"pdp_product_classes_plan[1].weight",label:"重量"}}),n("el-table-column",{attrs:{prop:"pdp_product_classes_plan[1].time",label:"时间"}})],1),n("el-table-column",{attrs:{label:"晚班计划"}},[n("el-table-column",{attrs:{label:"顺序",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return!t.row.sum&&t.row.pdp_product_classes_plan[2].enable?[n("el-input-number",{attrs:{min:0,precision:0},model:{value:t.row.pdp_product_classes_plan[2].sn,callback:function(n){e.$set(t.row.pdp_product_classes_plan[2],"sn",e._n(n))},expression:"scope.row.pdp_product_classes_plan[2].sn"}})]:void 0}}],null,!0)}),n("el-table-column",{attrs:{label:"车次",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.pdp_product_classes_plan[2].enable?[n("el-input-number",{attrs:{precision:0,disabled:t.row.sum,min:0},on:{change:function(n){return e.planTrainsChanged(t.row,2)}},model:{value:t.row.pdp_product_classes_plan[2].plan_trains,callback:function(n){e.$set(t.row.pdp_product_classes_plan[2],"plan_trains",e._n(n))},expression:"scope.row.pdp_product_classes_plan[2].plan_trains"}})]:void 0}}],null,!0)}),n("el-table-column",{attrs:{prop:"pdp_product_classes_plan[2].weight",label:"重量"}}),n("el-table-column",{attrs:{prop:"pdp_product_classes_plan[2].time",label:"时间"}})],1),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.sum?void 0:[n("el-button",{attrs:{type:"danger"},on:{click:function(n){return e.deleteOnePlan(t.row)}}},[e._v("删除")])]}}],null,!0)})],1)],1)},j=[],$=(n("4de4"),n("7db0"),n("4160"),n("c975"),n("a434"),n("a9e3"),n("b680"),n("d3b7"),n("159b"),n("ddb0"),{data:function(){return{addPlanVisible:!1,equipIdForAdd:null,equips:[],equipById:{},day_time:"",planScheduleId:null,planSchedules:[],workSchedules:[],plansForAdd:[],productBatchingById:{},saveEnable:!1,weightError:"",timeError:""}},watch:{plansForAdd:{handler:function(e){var t=this;this.saveEnable=!0,this.weightError="",this.timeError="",e.forEach((function(e){e.sum||e.pdp_product_classes_plan.forEach((function(e){e.weight>99999&&(t.saveEnable=!1,t.weightError="计划重量过大"),e.time>999999.99&&(t.saveEnable=!1,t.timeError="计划时间过大")}))}))},deep:!0}},created:function(){this.getEquipList(),this.getRubberMateria(),this.getWorkSchedules()},methods:{show:function(){this.plansForAdd=[],this.addPlanVisible=!0},getEquipList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c("get",{params:{all:1,category_name:"密炼设备"}});case 3:n=t.sent,e.equips=n.results,e.equips.forEach((function(t){e.equipById[t.id]=t})),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getRubberMateria:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w({all:1,used_type:4});case 3:n=t.sent,e.productBatchings=n.results,n.results.forEach((function(e){this.productBatchingById[e.id]=e})),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getWorkSchedules:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x({all:1});case 3:n=t.sent,e.workSchedules=n.results,t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getPlanSchedules:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.planSchedules=[],e.planScheduleId=null,!e.day_time){t.next=8;break}return t.next=6,y({all:1,day_time:e.day_time});case 6:n=t.sent,e.planSchedules=n.results;case 8:t.next=12;break;case 10:t.prev=10,t.t0=t["catch"](0);case 12:case"end":return t.stop()}}),t,null,[[0,10]])})))()},batchSave:function(){var e=this;if(this.plansForAdd.length){var t=this,n=[];this.plansForAdd.forEach((function(t){if(!t.sum){var a=JSON.parse(JSON.stringify(t));if(!a.product_batching)return void e.$alert("请选择所有胶料配方编码","错误",{confirmButtonText:"确定"});if(a.pdp_product_classes_plan=[],0===t.pdp_product_classes_plan.filter((function(e){return e.plan_trains>0})).length)return void e.$alert("至少一个班次的车次大于0","错误",{confirmButtonText:"确定"});for(var r=0;r<t.pdp_product_classes_plan.length;r++)t.pdp_product_classes_plan[r].enable&&a.pdp_product_classes_plan.push(t.pdp_product_classes_plan[r]);n.push(a)}})),n.length&&S(n).then((function(e){t.addPlanVisible=!1,t.$message("创建成功"),t.$emit("handleSuccessed")})).catch((function(e){}))}else this.$alert("请添加计划","错误",{confirmButtonText:"确定"})},addOnePlan:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,a,r,l,i,s,o,c,u,p,d,h,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.equipIdForAdd&&e.planScheduleId){t.next=3;break}return e.$alert("请选择机台和排班规则","错误",{confirmButtonText:"确定"}),t.abrupt("return");case 3:return t.next=5,k(e.planScheduleId);case 5:if(n=t.sent,a=e.workSchedules.find((function(e){return e.id===n.work_schedule})),n.work_schedule_plan.length){t.next=10;break}return e.$alert(n.work_schedule_name+"无排班","错误",{confirmButtonText:"确定"}),t.abrupt("return");case 10:for(r=a.classesdetail_set,l={plan_trains:0,sn:0,unit:"吨",time:"",weight:"",classes:null,enable:!1},i=[l,l,l],s=0;s<3;s++)o=!!n.work_schedule_plan[s],c=o?r[s].classes:null,u={plan_trains:0,sn:0,unit:"吨",time:o?0:"",weight:o?0:"",classes:c,enable:o},o&&"早班"===n.work_schedule_plan[s].classes_name?i[0]=u:o&&"中班"===n.work_schedule_plan[s].classes_name?i[1]=u:o&&"晚班"===n.work_schedule_plan[s].classes_name&&(i[2]=u);return p={equip_:e.equipById[e.equipIdForAdd],equip:e.equipIdForAdd,plan_schedule:e.planScheduleId,pdp_product_classes_plan:i,day_time:n.day_time,work_schedule_name:n.work_schedule_name},t.next=17,w({all:1,used_type:4,equip_id:e.equipIdForAdd});case 17:d=t.sent,e.$set(p,"productBatchings",d.results),d.results.forEach((function(t){e.productBatchingById[t.id]=t})),-1===e.equipFirstIndexInPlansForAdd()?(e.plansForAdd.push(p),h=JSON.parse(JSON.stringify(p)),h["sum"]=!0,h["equip_"].equip_no="小计",h["day_time"]=h["work_schedule_name"]=null,e.plansForAdd.push(h)):(f=e.equipLastIndexInPlansForAdd(),e.plansForAdd.splice(f,0,p));case 21:case"end":return t.stop()}}),t)})))()},equipLastIndexInPlansForAdd:function(){for(var e=0;e<this.plansForAdd.length;e++)if(this.plansForAdd[e].equip_.id===this.equipIdForAdd){for(var t=!0,n=e+1;n<this.plansForAdd.length;n++)this.plansForAdd[n]===this.equipIdForAdd&&(t=!1);if(t)return e}return-1},equipFirstIndexInPlansForAdd:function(){for(var e=0;e<this.plansForAdd.length;e++)if(this.plansForAdd[e].equip_.id===this.equipIdForAdd)return e;return-1},productBatchingChanged:function(e){e["batching_weight"]=this.productBatchingById[e.product_batching].batching_weight,e["production_time_interval"]=this.productBatchingById[e.product_batching].production_time_interval;for(var t=0;t<3;t++)this.planTrainsChanged(e,t,!1);this.statistic()},planTrainsChanged:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e["pdp_product_classes_plan"][t].enable&&(e["pdp_product_classes_plan"][t]["time"]=(e["production_time_interval"]*e["pdp_product_classes_plan"][t]["plan_trains"]).toFixed(2),e["pdp_product_classes_plan"][t]["weight"]=(e["batching_weight"]*e["pdp_product_classes_plan"][t]["plan_trains"]).toFixed(2),n&&this.statistic())},statistic:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,a,r,l,i,s,o,c,u,p,d,h,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n={},a={},e.plansForAdd.forEach((function(e){e.sum?a[e.equip]=e:(n[e.equip]||(n[e.equip]=[]),n[e.equip].push(e))})),t.t0=regeneratorRuntime.keys(n);case 4:if((t.t1=t.t0()).done){t.next=31;break}for(r=t.t1.value,l=n[r],i=0,s=0,o=[],c=0;c<3;c++)o.push({plan_trains:0,weight:0,time:0});u=0;case 12:if(!(u<l.length)){t.next=24;break}return p=l[u],t.next=16,k(p.plan_schedule);case 16:for(d=t.sent,d.data,i+=Number(p.batching_weight),s+=Number(p.production_time_interval),h=0;h<3;h++)f=p.pdp_product_classes_plan[h],o[h].plan_trains+=Number(f.plan_trains),o[h].weight+=Number(f.weight),o[h].time+=Number(f.time);case 21:u++,t.next=12;break;case 24:i=i.toFixed(3),s=s.toFixed(2),a[r].batching_weight=i,a[r].production_time_interval=s,a[r].pdp_product_classes_plan=o,t.next=4;break;case 31:case"end":return t.stop()}}),t)})))()},deleteOnePlan:function(e){this.plansForAdd.splice(this.plansForAdd.indexOf(e),1);var t=this.plansForAdd.filter((function(t){return t.equip===e.equip}));1===t.length&&t[0].sum&&this.plansForAdd.splice(this.plansForAdd.indexOf(t[0]),1),this.statistic()}}}),N=$,C=Object(R["a"])(N,T,j,!1,null,null,null),L=C.exports,B=n("3e51"),D=n("2f62"),V={components:{page:B["a"],AlterTrainNumberDialog:I,AddPlanDialog:L},data:function(){return{equip:"",equipOptions:[],params:{page:1},tableData:[],currentRow:{},currentAlive:{},total:0,page:1,findDialogVisible:!1,beginTime:"",endTime:"",recipe:"",recipeOptions:[],classes:"",classesOptions:[],findForm:{},formError:{},updateTrainsId:"",disabled:!0}},computed:Object(i["a"])({},Object(D["b"])(["permission"])),created:function(){this.permissionObj=this.permission,this.getEquip()},methods:{getEquip:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c("get");case 2:n=t.sent,e.equip=n.results[0].equip_no,e.clearFindForm(),e.getPlanStatusList(),e.getPlanList();case 7:case"end":return t.stop()}}),t)})))()},getPlanStatusList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,O({equip_no:e.equip});case 2:n=t.sent,e.currentAlive=n.results;case 4:case"end":return t.stop()}}),t)})))()},getPlanList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.params["page"]=e.page,e.params["equip_no"]=e.equip,e.beginTime&&(e.params["begin_time"]=e.beginTime),t.prev=3,t.next=6,u("get",{params:e.params});case 6:n=t.sent,e.tableData=n.results,e.total=n.count,t.next=13;break;case 11:t.prev=11,t.t0=t["catch"](3);case 13:case"end":return t.stop()}}),t,null,[[3,11]])})))()},getEquipList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c("get");case 3:n=t.sent,e.equipOptions=n.results,t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},refreshPlan:function(){this.getPlanStatusList(),this.getPlanList()},classesVisibleChange:function(e){e&&this.getClassList()},recipeVisibleChange:function(e){e&&this.getRecipeList()},equipVisibleChange:function(e){e&&this.getEquipList()},equipChange:function(){this.params={},this.page=1,this.clearFindForm(),this.getPlanStatusList(),this.getPlanList()},getClassList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v("get",{params:{all:1,class_name:"班次"}});case 3:n=t.sent,e.classesOptions=n.results,t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getRecipeList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g("get",{params:{all:1,distinct:1}});case 3:n=t.sent,e.recipeOptions=n.results,t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getBeginTime:function(e){var t=e.getFullYear(),n=e.getMonth()+1,a=n<10?"0"+n:n,r=e.getDate(),l=r<10?"0"+r:r;return t+"-"+a+"-"+l+" 00:00:00"},getEndTime:function(e){var t=e.getFullYear(),n=e.getMonth()+1,a=n<10?"0"+n:n,r=e.getDate(),l=r<10?"0"+r:r,i=e.getHours(),s=i<10?"0"+i:i,o=e.getMinutes(),c=o<10?"0"+o:o,u=e.getSeconds(),p=u<10?"0"+u:u;return t+"-"+a+"-"+l+" "+s+":"+c+":"+p},clearFindForm:function(){var e=new Date;this.endTime=this.getEndTime(e);var t=e.getTime()-864e5;e.setTime(t),this.beginTime=this.getBeginTime(e),this.classes="",this.recipe="",this.params={page:1}},clearFindFormError:function(){this.formError={}},showFindDialog:function(){this.clearFindForm(),this.clearFindFormError(),this.findDialogVisible=!0},findAlterTrainNumberSubmit:function(){this.endTime&&(this.params["end_time"]=this.endTime),this.classes&&(this.params["classes"]=this.classes),this.recipe&&(this.params["product_no"]=this.recipe),this.page=1,this.getPlanList(),this.findDialogVisible=!1},delPlan:function(){var e=this;this.$confirm("此操作将永久删除"+this.currentRow.plan_classes_uid+"计划, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){p(e.currentRow.id).then((function(t){e.$message({type:"success",message:"删除成功!"}),e.getPlanList()}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},upPlan:function(){var e=this;m(this.params,this.currentRow.id).then((function(t){e.$message({type:"success",message:"上调成功!"}),e.getPlanList()}))},downPlan:function(){var e=this;try{b(this.params,this.currentRow.id).then((function(t){e.$message({type:"success",message:"下调成功!"}),e.getPlanList()}))}catch(t){this.$message.error(t)}},stopPlan:function(){var e=this;h({id:this.currentRow.id,equip_no:this.equip}).then((function(t){e.$message({type:"success",message:"停止成功!"}),e.getPlanStatusList(),e.getPlanList()}))},retransmissionpPlan:function(){var e=this;f(this.currentRow).then((function(t){e.$message({type:"success",message:"重传成功!"}),e.getPlanStatusList(),e.getPlanList()}))},issuedPlan:function(){var e=this;this.$alert("机台： "+this.equip+"<br>计划编号： "+this.currentRow.plan_classes_uid+"<br>配方名称： "+this.currentRow.stage_product_batch_no,"提示",{showCancelButton:!0,dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){d(e.currentRow).then((function(t){e.$message({type:"success",message:"下达成功!"}),e.getPlanStatusList(),e.getPlanList()}))})).catch((function(){e.$message({type:"info",message:"已取消下达"})}))},showAlterTrainNumberDialog:function(){this.$refs.alterTrainNumberDialog.show(this.currentRow)},showAddPlanDialog:function(){this.$refs.addPlanDialog.show()},handleCurrentChange:function(e){this.currentRow=e,this.disabled=!e},currentChange:function(e){this.page=e,this.getPlanList()}}},M=V,U=Object(R["a"])(M,a,r,!1,null,"18cb3a30",null);t["default"]=U.exports},a434:function(e,t,n){"use strict";var a=n("23e7"),r=n("23cb"),l=n("a691"),i=n("50c4"),s=n("7b0b"),o=n("65f0"),c=n("8418"),u=n("1dde"),p=n("ae40"),d=u("splice"),h=p("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,m=Math.min,b=9007199254740991,_="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!d||!h},{splice:function(e,t){var n,a,u,p,d,h,g=s(this),v=i(g.length),w=r(e,v),x=arguments.length;if(0===x?n=a=0:1===x?(n=0,a=v-w):(n=x-2,a=m(f(l(t),0),v-w)),v+n-a>b)throw TypeError(_);for(u=o(g,a),p=0;p<a;p++)d=w+p,d in g&&c(u,p,g[d]);if(u.length=a,n<a){for(p=w;p<v-a;p++)d=p+a,h=p+n,d in g?g[h]=g[d]:delete g[h];for(p=v;p>v-a+n;p--)delete g[p-1]}else if(n>a)for(p=v-a;p>w;p--)d=p+a-1,h=p+n-1,d in g?g[h]=g[d]:delete g[h];for(p=0;p<n;p++)g[p+w]=arguments[p+2];return g.length=v-a+n,u}})},a9e3:function(e,t,n){"use strict";var a=n("83ab"),r=n("da84"),l=n("94ca"),i=n("6eeb"),s=n("5135"),o=n("c6b6"),c=n("7156"),u=n("c04e"),p=n("d039"),d=n("7c73"),h=n("241c").f,f=n("06cf").f,m=n("9bf2").f,b=n("58a8").trim,_="Number",g=r[_],v=g.prototype,w=o(d(v))==_,x=function(e){var t,n,a,r,l,i,s,o,c=u(e,!1);if("string"==typeof c&&c.length>2)if(c=b(c),t=c.charCodeAt(0),43===t||45===t){if(n=c.charCodeAt(2),88===n||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:a=2,r=49;break;case 79:case 111:a=8,r=55;break;default:return+c}for(l=c.slice(2),i=l.length,s=0;s<i;s++)if(o=l.charCodeAt(s),o<48||o>r)return NaN;return parseInt(l,a)}return+c};if(l(_,!g(" 0o1")||!g("0b1")||g("+0x1"))){for(var y,k=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof k&&(w?p((function(){v.valueOf.call(n)})):o(n)!=_)?c(new g(x(t)),n,k):x(t)},S=a?h(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),O=0;S.length>O;O++)s(g,y=S[O])&&!s(k,y)&&m(k,y,f(g,y));k.prototype=v,v.constructor=k,i(r,_,k)}},b680:function(e,t,n){"use strict";var a=n("23e7"),r=n("a691"),l=n("408a"),i=n("1148"),s=n("d039"),o=1..toFixed,c=Math.floor,u=function(e,t,n){return 0===t?n:t%2===1?u(e,t-1,n*e):u(e*e,t/2,n)},p=function(e){var t=0,n=e;while(n>=4096)t+=12,n/=4096;while(n>=2)t+=1,n/=2;return t},d=o&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!s((function(){o.call({})}));a({target:"Number",proto:!0,forced:d},{toFixed:function(e){var t,n,a,s,o=l(this),d=r(e),h=[0,0,0,0,0,0],f="",m="0",b=function(e,t){var n=-1,a=t;while(++n<6)a+=e*h[n],h[n]=a%1e7,a=c(a/1e7)},_=function(e){var t=6,n=0;while(--t>=0)n+=h[t],h[t]=c(n/e),n=n%e*1e7},g=function(){var e=6,t="";while(--e>=0)if(""!==t||0===e||0!==h[e]){var n=String(h[e]);t=""===t?n:t+i.call("0",7-n.length)+n}return t};if(d<0||d>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(f="-",o=-o),o>1e-21)if(t=p(o*u(2,69,1))-69,n=t<0?o*u(2,-t,1):o/u(2,t,1),n*=4503599627370496,t=52-t,t>0){b(0,n),a=d;while(a>=7)b(1e7,0),a-=7;b(u(10,a,1),0),a=t-1;while(a>=23)_(1<<23),a-=23;_(1<<a),b(1,1),_(2),m=g()}else b(0,n),b(1<<-t,0),m=g()+i.call("0",d);return d>0?(s=m.length,m=f+(s<=d?"0."+i.call("0",d-s)+m:m.slice(0,s-d)+"."+m.slice(s-d))):m=f+m,m}})}}]);